language: cypher

per-class-metrics:
  - metric: abstracts_deps_count
    query: |
      MATCH (c {name: $class_name})-[r]->(dependent:Abstract)
      RETURN count(r) AS metric
  - metric: concrete_deps_count
    query: |
      MATCH (c {name: $class_name})-[r]->(dependent:Class)
      RETURN count(r) AS metric
  - metric: afferent_count
    query: |
      MATCH (external)-[r]->(c {name: $class_name})
      RETURN count(r) AS metric
  - metric: efferent_count
    query: |
      MATCH (c {name: $class_name})-[r]->(external)
      RETURN count(r) AS metric

general-metrics:
  - metric: deleted_classes
    query: |
      MATCH (b)
      WHERE b.name STARTS WITH 'before'
        AND NOT EXISTS {
          MATCH (a)
          WHERE a.name = 'after' + substring(b.name, 6)
        }
      RETURN count(b) AS deleted_nodes_count
  - metric: added_classes
    query: |
      MATCH (a)
      WHERE a.name STARTS WITH 'after'
        AND NOT EXISTS {
          MATCH (b)
          WHERE b.name = 'before' + substring(a.name, 5)
        }
      RETURN count(a) AS added_nodes_count
  - metric: base_class_change
  # number of classes that have changed their base class
    query: |
      MATCH (a)-[r]->(b)
      WHERE a.name STARTS WITH 'after'
        AND b.name STARTS WITH 'after'
        AND NOT EXISTS {
          MATCH (c)-[r]->(d)
          WHERE c.name = 'before' + substring(a.name, 5)
            AND d.name = 'before' + substring(b.name, 5)
        }
      RETURN count(r) AS metric