language: cypher

per-class-metrics:
  - metric: abstracts_deps_count
    query: |
      MATCH (c {name: $class_name})-[r]->(dependent:Abstract)
      RETURN count(r) AS metric
  - metric: concrete_deps_count
    query: |
      MATCH (c {name: $class_name})-[r]->(dependent:Class)
      RETURN count(r) AS metric
  - metric: afferent_count
    query: |
      MATCH (external)-[r]->(c {name: $class_name})
      RETURN count(r) AS metric
  - metric: efferent_count
    query: |
      MATCH (c {name: $class_name})-[r]->(external)
      RETURN count(r) AS metric

general-metrics:
  - metric: all_classes
    query: |
      MATCH (c) RETURN c.name AS name
  - metric: all_relations
    query: |
      MATCH (c {name: $class_name})-[r]->(dependent)
      RETURN type(r) AS relation, dependent.name AS dependent
  - metric: delete_classes
    query: |
      MATCH (b)
      WHERE b.name STARTS WITH 'before'
        AND NOT EXISTS {
          MATCH (a)
          WHERE a.name = 'after' + substring(b.name, 6)
        }
      RETURN b.name AS deleted_nodes
  - metric: add_classes
    query: |
      MATCH (a)
      WHERE a.name STARTS WITH 'after'
        AND NOT EXISTS {
          MATCH (b)
          WHERE b.name = 'before' + substring(a.name, 5)
        }
      RETURN a.name AS added_nodes